<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dolphin Coin Referral System</title>
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }
    .container {
      padding: 30px;
      max-width: 500px;
      margin: 0 auto;
      background-color: #1e293b;
      color: white;
      border-radius: 12px;
      margin-top: 50px;
      text-align: center;
    }
    .invite-box {
      background-color: #334155;
      padding: 20px;
      border-radius: 20px;
      margin-bottom: 20px;
    }
    .invite-box img {
      width: 50px;
      height: 50px;
      margin-right: 10px;
      vertical-align: middle;
    }
    .btn {
      padding: 15px;
      width: 100%;
      background-color: #475569;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #64748b;
    }
    #copyMessage {
      color: #22c55e;
      margin-top: 15px;
      display: none;
    }
    .balance-display {
      margin: 20px 0;
      font-size: 18px;
    }
    .recent-referrals {
      margin-top: 20px;
      text-align: left;
    }
    .referral-item {
      background-color: #334155;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>üê¨ DolphinCoin Referral System</h2>
    
    <!-- Balance Display -->
    <div class="balance-display">
      Your Balance: <span id="userBalance">0</span> coins
    </div>

    <!-- Referral Section -->
    <div class="invite-box">
      <img src="https://img.icons8.com/color/48/gift.png" alt="gift">
      <span><strong>Invite a friend</strong><br>+5,000 for you and your friend</span>
    </div>

    <button id="inviteButton" class="btn">Invite a Friend</button>
    <p id="copyMessage">Copied to clipboard!</p>

    <!-- Recent Referrals -->
    <div class="recent-referrals" id="recentReferrals" style="display: none;">
      <h3>Recent Referrals</h3>
      <div id="referralList"></div>
    </div>
  </div>

  <script>
    // Initialize user data
    let userData = {
      id: '',
      balance: 0,
      referrals: []
    };

    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get('ref');
    const chatId = urlParams.get('chat_id') || "user_" + Math.random().toString(36).substr(2, 9);

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      // Load user data from localStorage or initialize
      loadUserData();
      
      // Check if coming from referral
      if (refCode && refCode !== userData.id) {
        processReferral(refCode);
      }
      
      // Update UI
      updateUI();
    });

    // Load or initialize user data
    function loadUserData() {
      const savedData = localStorage.getItem('dolphinCoinUserData');
      if (savedData) {
        userData = JSON.parse(savedData);
      } else {
        userData = {
          id: chatId,
          balance: 0,
          referrals: []
        };
        saveUserData();
      }
    }

    // Save user data
    function saveUserData() {
      localStorage.setItem('dolphinCoinUserData', JSON.stringify(userData));
    }

    // Process a new referral
    function processReferral(referrerId) {
      // Check if this is a new referral
      if (!userData.referrals.some(ref => ref.referrer === referrerId)) {
        // Add bonus to current user
        userData.balance += 5000;
        
        // Add bonus to referrer (simulated - in real app this would be server-side)
        // Note: In a real app, you would need server-side code to update referrer's balance
        
        // Record the referral
        userData.referrals.push({
          referrer: referrerId,
          date: new Date().toLocaleString(),
          bonus: 5000
        });
        
        saveUserData();
        updateUI();
        
        // Show success message
        alert("Welcome bonus of 5,000 coins added to your account!");
      }
    }

    // Update the UI
    function updateUI() {
      // Update balance
      document.getElementById('userBalance').textContent = userData.balance.toLocaleString();
      
      // Show recent referrals if any
      if (userData.referrals.length > 0) {
        document.getElementById('recentReferrals').style.display = 'block';
        const referralList = document.getElementById('referralList');
        referralList.innerHTML = '';
        
        userData.referrals.slice(0, 5).forEach(ref => {
          const item = document.createElement('div');
          item.className = 'referral-item';
          item.innerHTML = `
            <div>From: ${ref.referrer}</div>
            <div>Date: ${ref.date}</div>
            <div>Bonus: +${ref.bonus.toLocaleString()} coins</div>
          `;
          referralList.appendChild(item);
        });
      }
    }

    // Handle invite button click
    document.getElementById('inviteButton').addEventListener('click', function() {
      const referralLink = `https://t.me/share/url?url=https://t.me/dolphincoinearning_bot?start=ref${userData.id}&text=Join%20me%20in%20DolphinCoin%20and%20start%20earning%20today!%20Get%205,000%20bonus%20coins!`;
      
      navigator.clipboard.writeText(referralLink).then(function() {
        const copyMessage = document.getElementById('copyMessage');
        copyMessage.style.display = 'block';
        
        setTimeout(function() {
          copyMessage.style.display = 'none';
          window.location = referralLink;
        }, 2000);
      }).catch(function(err) {
        console.error('Error copying referral link:', err);
        window.location = referralLink;
      });
    });

    // Simulate adding coins (for demo purposes)
    function addCoins(amount) {
      userData.balance += amount;
      saveUserData();
      updateUI();
    }
  </script>

  <!-- For demo purposes - remove in production -->
  <div style="position: fixed; bottom: 10px; right: 10px; background: white; padding: 10px; border-radius: 5px;">
    <button onclick="addCoins(1000)">Add 1,000 coins (demo)</button>
    <button onclick="localStorage.removeItem('dolphinCoinUserData'); location.reload();">Reset Data</button>
  </div>

</body>
</html>
