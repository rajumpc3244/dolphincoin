<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src='//whephiwums.com/sdk.js' data-zone='9237110' data-sdk='show_9237110'></script>
  <title>Dolphin Coin Referral</title>
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }

    .container {
      padding: 30px;
      max-width: 500px;
      margin: 0 auto;
      background-color: #1e293b;
      color: white;
      border-radius: 12px;
      margin-top: 50px;
      text-align: center;
    }

    .invite-box {
      background-color: #334155;
      padding: 20px;
      border-radius: 20px;
      margin-bottom: 20px;
    }

    .invite-box img {
      width: 50px;
      height: 50px;
      margin-right: 10px;
      vertical-align: middle;
    }

    .btn {
      padding: 15px;
      width: 100%;
      background-color: #475569;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #64748b;
    }

    #copyMessage {
      color: #22c55e;
      margin-top: 15px;
      display: none;
    }

    .balance-display {
      margin: 20px 0;
      font-size: 18px;
    }

    .bonus-info {
      margin-top: 20px;
      padding: 15px;
      background-color: #334155;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>üê¨ Invite Friends to DolphinCoin</h2>
    <p>You and your friend will receive bonuses</p>

    <div class="balance-display">
      Your Balance: <span id="userBalance">0</span> coins
    </div>

    <div class="invite-box">
      <img src="https://img.icons8.com/color/48/gift.png" alt="gift">
      <span><strong>Invite a friend</strong><br>+5,000 for you and your friend</span>
    </div>

    <button id="inviteButton" class="btn">Invite a Friend</button>
    <p id="copyMessage">Copy Success..!</p>

    <div class="bonus-info">
      <h3>Referral Bonus System</h3>
      <p>‚Ä¢ You get 5,000 coins when your friend joins</p>
      <p>‚Ä¢ Your friend gets 5,000 coins bonus</p>
      <p>‚Ä¢ Track your referrals below</p>
    </div>
  </div>

  <script>
    // Get chat_id from URL or use default
    const urlParams = new URLSearchParams(window.location.search);
    const chatId = urlParams.get('chat_id') || "defaultuser";
    const REFERRAL_BONUS = 5000;
    
    // Initialize user balance from localStorage
    let userBalance = parseInt(localStorage.getItem('dolphinCoinBalance')) || 0;
    document.getElementById('userBalance').textContent = userBalance.toLocaleString();
    
    // Check if this is a referral visit
    const isReferralVisit = document.referrer.includes('dolphincoinearning_bot');
    const refParam = urlParams.get('ref');
    
    if (refParam && !localStorage.getItem('hasReceivedReferralBonus')) {
      // This is a new user coming from a referral link
      awardReferralBonus(refParam);
    }

    // Handle invite button click
    document.getElementById('inviteButton').addEventListener('click', function() {
      const referralLink = `https://t.me/share/url?url=https://t.me/dolphincoinearning_bot?start=ref${chatId}&text=Join%20me%20in%20DolphinCoin%20and%20start%20earning%20today!%20Let's%20earn%20together!`;
      
      navigator.clipboard.writeText(referralLink).then(function() {
        const copyMessage = document.getElementById('copyMessage');
        copyMessage.style.display = 'block';
        
        setTimeout(function() {
          copyMessage.style.display = 'none';
          window.location = referralLink;
        }, 2000);
      }).catch(function(err) {
        console.error('Error copying referral link:', err);
        window.location = referralLink;
      });
    });

    // Function to award referral bonus
    function awardReferralBonus(referrerId) {
      // Award bonus to new user
      userBalance += REFERRAL_BONUS;
      updateBalance();
      
      // Mark that this user has received their bonus
      localStorage.setItem('hasReceivedReferralBonus', 'true');
      
      // In a real app, you would send the referrerId to your backend
      // to award the referrer their bonus
      // For this demo, we'll simulate it in localStorage
      if (typeof(Storage) !== "undefined") {
        let referrals = JSON.parse(localStorage.getItem('referralData')) || {};
        if (!referrals[referrerId]) {
          referrals[referrerId] = 0;
        }
        referrals[referrerId] += REFERRAL_BONUS;
        localStorage.setItem('referralData', JSON.stringify(referrals));
      }
      
      alert(`Welcome bonus of ${REFERRAL_BONUS.toLocaleString()} coins added to your account!`);
    }

    // Function to update balance display and storage
    function updateBalance() {
      document.getElementById('userBalance').textContent = userBalance.toLocaleString();
      localStorage.setItem('dolphinCoinBalance', userBalance);
    }

    // Check for referral bonus on page load
    window.addEventListener('load', function() {
      const ref = urlParams.get('ref');
      if (ref && !localStorage.getItem('hasReceivedReferralBonus')) {
        awardReferralBonus(ref);
      }
    });
  </script>

</body>
</html>
