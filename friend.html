<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dolphin Coin Referral System</title>
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f8ff;
    }
    .header {
      display: flex;
      align-items: center;
      padding: 15px;
      background-color: #1e293b;
      color: white;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 100;
    }
    .back-btn {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      margin-right: 15px;
    }
    .page {
      display: none;
      padding: 30px;
      max-width: 500px;
      margin: 80px auto 30px;
      background-color: #1e293b;
      color: white;
      border-radius: 12px;
      text-align: center;
    }
    .active-page {
      display: block;
    }
    .logo {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
    }
    .btn {
      padding: 15px;
      width: 100%;
      background-color: #3b82f6;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 20px;
    }
    .btn-share {
      background-color: #22c55e;
    }
    .bonus-info {
      background-color: #334155;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
    }
    .stat-box {
      background-color: #334155;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      flex: 1;
      margin: 0 5px;
    }
    .referral-link {
      background-color: #334155;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      word-break: break-all;
    }
    .recent-refs {
      margin-top: 30px;
    }
    .ref-item {
      background-color: #334155;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
    }
    #copyMessage, #successMessage, #dashboardMessage {
      color: #22c55e;
      margin-top: 15px;
      display: none;
    }
    .success-icon {
      font-size: 60px;
      color: #22c55e;
      margin-bottom: 20px;
    }
    .page-title {
      flex-grow: 1;
      text-align: center;
      margin-right: 40px;
    }
  </style>
</head>
<body>
  <!-- Header with Back Button -->
  <div class="header">
    <button id="backButton" class="back-btn" style="display: none;">‚Üê</button>
    <div class="page-title" id="pageTitle">Dolphin Coin</div>
  </div>

  <!-- Landing Page -->
  <div id="landingPage" class="page active-page">
    <img src="https://img.icons8.com/color/96/dolphin.png" alt="Dolphin Coin" class="logo">
    <h1>Welcome to Dolphin Coin!</h1>
    
    <div class="bonus-info">
      <h3>üéÅ Referral Bonus</h3>
      <p id="referralOffer">Sign up now to start earning!</p>
    </div>
    
    <button id="joinButton" class="btn">Join Dolphin Coin</button>
    <p id="copyMessage">Redirecting to Telegram...</p>
  </div>

  <!-- Dashboard Page -->
  <div id="dashboardPage" class="page">
    <img src="https://img.icons8.com/color/96/dolphin.png" alt="Dolphin Coin" class="logo">
    <h1>üê¨ Referral Dashboard</h1>
    
    <div class="stats">
      <div class="stat-box">
        <h3>Total Referrals</h3>
        <p id="totalRefs">0</p>
      </div>
      <div class="stat-box">
        <h3>Earned Bonus</h3>
        <p id="totalBonus">0</p>
      </div>
    </div>
    
    <h3>Your Referral Link</h3>
    <div class="referral-link" id="refLink">
      Loading...
    </div>
    
    <button id="copyBtn" class="btn">Copy Referral Link</button>
    <button id="shareBtn" class="btn btn-share">Share on Telegram</button>
    <p id="dashboardMessage">Link copied to clipboard!</p>
    
    <div class="recent-refs">
      <h3>Recent Referrals</h3>
      <div id="refList">
        <p>No referrals yet</p>
      </div>
    </div>
  </div>

  <!-- Success Page -->
  <div id="successPage" class="page">
    <div class="success-icon">‚úì</div>
    <h1>Referral Successful!</h1>
    <p>You and your friend have both received 5,000 bonus coins.</p>
    <p>Your new balance: <strong id="newBalance">15,000 coins</strong></p>
    
    <button id="dashboardBtn" class="btn">Go to Referral Dashboard</button>
    <button id="inviteMoreBtn" class="btn btn-share">Invite More Friends</button>
  </div>

  <script>
    // Global variables
    let userId = "";
    let refCode = "";
    let balance = 0;
    
    // Initialize the page
    function init() {
      // Get URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      refCode = urlParams.get('ref') || '';
      userId = localStorage.getItem('dolphin_user_id') || "USER_" + Math.floor(Math.random() * 10000);
      balance = parseInt(localStorage.getItem('dolphin_balance')) || 0;
      
      // If coming from Telegram with start parameter
      const startParam = urlParams.get('start');
      if (startParam && startParam.startsWith('ref_')) {
        processReferral(startParam.replace('ref_', ''));
        showPage('successPage');
      } else if (localStorage.getItem('dolphin_user_id')) {
        showPage('dashboardPage');
        loadDashboard();
      } else if (refCode) {
        document.getElementById('referralOffer').textContent = 
          "You're joining with a referral link! Both you and your friend will receive 5,000 bonus coins.";
      }
      
      // Set up back button
      document.getElementById('backButton').addEventListener('click', function() {
        showPage('landingPage');
      });
    }
    
    // Show specific page and hide others
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active-page');
      });
      document.getElementById(pageId).classList.add('active-page');
      
      // Show/hide back button (only show on dashboard and success pages)
      const backButton = document.getElementById('backButton');
      if (pageId === 'landingPage') {
        backButton.style.display = 'none';
      } else {
        backButton.style.display = 'block';
      }
      
      // Update page title
      updatePageTitle(pageId);
      
      // Load data if needed
      if (pageId === 'dashboardPage') {
        loadDashboard();
      }
    }
    
    // Update page title in header
    function updatePageTitle(pageId) {
      const titles = {
        'landingPage': 'Welcome',
        'dashboardPage': 'Referral Dashboard',
        'successPage': 'Success'
      };
      document.getElementById('pageTitle').textContent = titles[pageId] || 'Dolphin Coin';
    }
    
    // Process referral
    function processReferral(referrerId) {
      if (referrerId && referrerId !== userId) {
        // In a real app, this would call your backend
        balance += 5000;
        localStorage.setItem('dolphin_balance', balance);
        localStorage.setItem('dolphin_user_id', userId);
        
        // Record the referral (simulated)
        let referrals = JSON.parse(localStorage.getItem('dolphin_referrals') || []);
        referrals.push({
          id: "USER_" + Math.floor(Math.random() * 10000),
          date: new Date().toLocaleDateString(),
          bonus: 5000
        });
        localStorage.setItem('dolphin_referrals', JSON.stringify(referrals));
        
        document.getElementById('newBalance').textContent = balance.toLocaleString() + " coins";
      }
    }
    
    // Load dashboard data
    function loadDashboard() {
      const refLink = `${window.location.origin}${window.location.pathname}?ref=${userId}`;
      document.getElementById('refLink').textContent = refLink;
      
      // Load stats (simulated)
      let referrals = JSON.parse(localStorage.getItem('dolphin_referrals') || []);
      document.getElementById('totalRefs').textContent = referrals.length;
      document.getElementById('totalBonus').textContent = (referrals.length * 5000).toLocaleString();
      
      // Load recent referrals
      const refList = document.getElementById('refList');
      if (referrals.length > 0) {
        refList.innerHTML = referrals.slice(0, 3).map(ref => `
          <div class="ref-item">
            <span>${ref.id}</span>
            <span>+${ref.bonus.toLocaleString()}</span>
          </div>
        `).join('');
      } else {
        refList.innerHTML = '<p>No referrals yet</p>';
      }
    }
    
    // Event listeners
    document.getElementById('joinButton').addEventListener('click', function() {
      const telegramLink = `https://t.me/dolphincoinearning_bot?start=ref_${refCode || userId}`;
      
      navigator.clipboard.writeText(telegramLink).then(function() {
        document.getElementById('copyMessage').style.display = 'block';
        setTimeout(function() {
          window.location.href = telegramLink;
        }, 1000);
      }).catch(function(err) {
        console.error('Error copying link:', err);
        window.location.href = telegramLink;
      });
    });
    
    document.getElementById('copyBtn').addEventListener('click', function() {
      const refLink = document.getElementById('refLink').textContent;
      navigator.clipboard.writeText(refLink).then(() => {
        const message = document.getElementById('dashboardMessage');
        message.style.display = 'block';
        setTimeout(() => message.style.display = 'none', 2000);
      });
    });
    
    document.getElementById('shareBtn').addEventListener('click', function() {
      const refLink = document.getElementById('refLink').textContent;
      const shareText = `Join Dolphin Coin with my referral link and get 5,000 bonus coins! ${refLink}`;
      window.open(`https://t.me/share/url?url=${encodeURIComponent(refLink)}&text=${encodeURIComponent(shareText)}`);
    });
    
    document.getElementById('dashboardBtn').addEventListener('click', function() {
      showPage('dashboardPage');
    });
    
    document.getElementById('inviteMoreBtn').addEventListener('click', function() {
      showPage('dashboardPage');
    });
    
    // Initialize the app
    init();
  </script>
</body>
</html>
