// server.js
const express = require('express');
const mongoose = require('mongoose');
const app = express();

// Connect to MongoDB
mongoose.connect('mongodb://localhost:27017/dolphin_bot');

// User model
const User = mongoose.model('User', {
    userId: Number,
    username: String,
    referralCode: String,
    referralEarnings: Number,
    referrals: Array
});

// API endpoint to get referral data
app.get('/api/referral', async (req, res) => {
    const userId = parseInt(req.query.userId);
    
    try {
        const user = await User.findOne({ userId });
        if (!user) return res.status(404).send('User not found');
        
        // Get top 10 referrers for leaderboard
        const leaderboard = await User.find()
            .sort({ referralEarnings: -1 })
            .limit(10)
            .select('username referralEarnings referrals');
        
        res.json({
            referralCode: user.referralCode,
            totalReferrals: user.referrals.length,
            referralEarnings: user.referralEarnings,
            leaderboard: leaderboard.map(u => ({
                username: u.username,
                referrals: u.referrals.length,
                earnings: u.referralEarnings
            }))
        });
    } catch (error) {
        res.status(500).send('Server error');
    }
});

app.listen(3000, () => console.log('Server running on port 3000'));
